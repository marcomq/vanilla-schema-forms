{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Map_of_Route",
  "type": "object",
  "additionalProperties": {
    "$ref": "#/$defs/Route"
  },
  "$defs": {
    "AmqpEndpoint": {
      "description": "AMQP endpoint configuration, combining connection and queue details.",
      "type": "object",
      "properties": {
        "delayed_ack": {
          "description": "(Publisher only) If true, do not wait for an acknowledgement when sending to broker. Defaults to false.",
          "type": "boolean",
          "default": false
        },
        "exchange": {
          "description": "The exchange to publish to or bind the queue to.",
          "type": ["string", "null"]
        },
        "no_persistence": {
          "description": "If true, declare queues as non-durable (transient). Defaults to false.",
          "type": "boolean",
          "default": false
        },
        "password": {
          "description": "Optional password for authentication.",
          "type": ["string", "null"]
        },
        "prefetch_count": {
          "description": "Number of messages to prefetch. Defaults to 100.",
          "type": ["integer", "null"],
          "format": "uint16",
          "maximum": 65535,
          "minimum": 0
        },
        "queue": {
          "type": ["string", "null"]
        },
        "tls": {
          "description": "TLS configuration.",
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "accept_invalid_certs": false,
            "ca_file": null,
            "cert_file": null,
            "cert_password": null,
            "key_file": null,
            "required": false
          }
        },
        "url": {
          "description": "AMQP connection URI. The `lapin` client connects to a single host specified in the URI.\nFor high availability, provide the address of a load balancer or use DNS resolution\nthat points to multiple brokers. Example: \"amqp://localhost:5672/vhost\".",
          "type": "string"
        },
        "username": {
          "description": "Optional username for authentication.",
          "type": ["string", "null"]
        }
      },
      "additionalProperties": false,
      "required": ["url"]
    },
    "CommitConcurrencyMiddleware": {
      "description": "Configuration for limiting the number of parallel commit tasks of publishers.",
      "type": "object",
      "properties": {
        "limit": {
          "type": "integer",
          "format": "uint",
          "minimum": 0
        }
      },
      "additionalProperties": false,
      "required": ["limit"]
    },
    "ConsumerMode": {
      "type": "string",
      "enum": ["consume", "subscribe"]
    },
    "DeadLetterQueueMiddleware": {
      "description": "Dead-Letter Queue (DLQ) middleware configuration.",
      "type": "object",
      "properties": {
        "dlq_initial_interval_ms": {
          "type": "integer",
          "format": "uint64",
          "default": 100,
          "minimum": 0
        },
        "dlq_max_interval_ms": {
          "type": "integer",
          "format": "uint64",
          "default": 5000,
          "minimum": 0
        },
        "dlq_multiplier": {
          "type": "number",
          "format": "double",
          "default": 2.0
        },
        "dlq_retry_attempts": {
          "description": "Number of retry attempts for the DLQ send. Defaults to 3.",
          "type": "integer",
          "format": "uint",
          "default": 3,
          "minimum": 0
        },
        "endpoint": {
          "$ref": "#/$defs/Endpoint"
        }
      },
      "additionalProperties": false,
      "required": ["endpoint"]
    },
    "DeduplicationMiddleware": {
      "description": "Deduplication middleware configuration.",
      "type": "object",
      "properties": {
        "sled_path": {
          "type": "string"
        },
        "ttl_seconds": {
          "type": "integer",
          "format": "uint64",
          "minimum": 0
        }
      },
      "additionalProperties": false,
      "required": ["sled_path", "ttl_seconds"]
    },
    "DelayMiddleware": {
      "type": "object",
      "properties": {
        "delay_ms": {
          "type": "integer",
          "format": "uint64",
          "minimum": 0
        }
      },
      "additionalProperties": false,
      "required": ["delay_ms"]
    },
    "Endpoint": {
      "description": "Represents a connection point for messages, which can be a source (input) or a sink (output).",
      "type": "object",
      "properties": {
        "middlewares": {
          "description": "(Optional) A list of middlewares to apply to the endpoint.",
          "type": "array",
          "default": [],
          "items": {
            "$ref": "#/$defs/Middleware"
          }
        },
        "mode": {
          "description": "(input only) The processing mode for the endpoint.",
          "$ref": "#/$defs/ConsumerMode",
          "default": "consume"
        }
      },
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "kafka": {
              "$ref": "#/$defs/KafkaEndpoint"
            }
          },
          "required": ["kafka"]
        },
        {
          "type": "object",
          "properties": {
            "nats": {
              "$ref": "#/$defs/NatsEndpoint"
            }
          },
          "required": ["nats"]
        },
        {
          "type": "object",
          "properties": {
            "file": {
              "type": "string"
            }
          },
          "required": ["file"]
        },
        {
          "type": "object",
          "properties": {
            "static": {
              "type": "string"
            }
          },
          "required": ["static"]
        },
        {
          "type": "object",
          "properties": {
            "memory": {
              "$ref": "#/$defs/MemoryConfig"
            }
          },
          "required": ["memory"]
        },
        {
          "type": "object",
          "properties": {
            "amqp": {
              "$ref": "#/$defs/AmqpEndpoint"
            }
          },
          "required": ["amqp"]
        },
        {
          "type": "object",
          "properties": {
            "mongodb": {
              "$ref": "#/$defs/MongoDbEndpoint"
            }
          },
          "required": ["mongodb"]
        },
        {
          "type": "object",
          "properties": {
            "mqtt": {
              "$ref": "#/$defs/MqttEndpoint"
            }
          },
          "required": ["mqtt"]
        },
        {
          "type": "object",
          "properties": {
            "ibmmq": {
              "$ref": "#/$defs/IbmMqEndpoint"
            }
          },
          "required": ["ibmmq"]
        },
        {
          "type": "object",
          "properties": {
            "http": {
              "$ref": "#/$defs/HttpEndpoint"
            }
          },
          "required": ["http"]
        },
        {
          "type": "object",
          "properties": {
            "zeromq": {
              "$ref": "#/$defs/ZeroMqEndpoint"
            }
          },
          "required": ["zeromq"]
        },
        {
          "type": "object",
          "properties": {
            "fanout": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/Endpoint"
              }
            }
          },
          "required": ["fanout"]
        },
        {
          "type": "object",
          "properties": {
            "switch": {
              "$ref": "#/$defs/SwitchConfig"
            }
          },
          "required": ["switch"]
        },
        {
          "type": "object",
          "properties": {
            "response": {
              "$ref": "#/$defs/ResponseConfig"
            }
          },
          "required": ["response"]
        },
        {
          "type": "object",
          "properties": {
            "null": {
              "type": "null"
            }
          },
          "required": ["null"]
        }
      ],
      "unevaluatedProperties": false
    },
    "HttpEndpoint": {
      "description": "HTTP endpoint configuration.",
      "type": "object",
      "properties": {
        "response_out": {
          "description": "(Consumer only) Optional endpoint to send the response to.",
          "anyOf": [
            {
              "$ref": "#/$defs/Endpoint"
            },
            {
              "type": "null"
            }
          ]
        },
        "tls": {
          "description": "TLS configuration.",
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "accept_invalid_certs": false,
            "ca_file": null,
            "cert_file": null,
            "cert_password": null,
            "key_file": null,
            "required": false
          }
        },
        "url": {
          "description": "For consumers, the listen address (e.g., \"0.0.0.0:8080\"). For publishers, the target URL.",
          "type": ["string", "null"]
        }
      },
      "additionalProperties": false
    },
    "IbmMqEndpoint": {
      "description": "General IBM MQ connection configuration.",
      "type": "object",
      "properties": {
        "channel": {
          "description": "The channel name.",
          "type": "string"
        },
        "cipher_spec": {
          "description": "Cipher spec for TLS connection.",
          "type": ["string", "null"]
        },
        "connection_name": {
          "description": "Comma-separated list of IBM MQ connection names (e.g., \"localhost(1414),otherhost(1414)\").",
          "type": "string"
        },
        "password": {
          "description": "Optional password for authentication.",
          "type": ["string", "null"]
        },
        "queue": {
          "type": ["string", "null"]
        },
        "queue_manager": {
          "description": "The queue manager name.",
          "type": "string"
        },
        "tls": {
          "description": "TLS configuration.",
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "accept_invalid_certs": false,
            "ca_file": null,
            "cert_file": null,
            "cert_password": null,
            "key_file": null,
            "required": false
          }
        },
        "topic": {
          "type": ["string", "null"]
        },
        "user": {
          "description": "Optional username for authentication.",
          "type": ["string", "null"]
        }
      },
      "additionalProperties": false,
      "required": ["connection_name", "queue_manager", "channel"]
    },
    "KafkaEndpoint": {
      "description": "Kafka endpoint configuration, combining connection and topic details.",
      "type": "object",
      "properties": {
        "brokers": {
          "description": "Comma-separated list of Kafka broker URLs. Can also be specified using the alias 'url'.",
          "type": "string"
        },
        "consumer_options": {
          "description": "Additional librdkafka consumer configuration options (key-value pairs).",
          "type": ["array", "null"],
          "default": null,
          "items": {
            "type": "array",
            "maxItems": 2,
            "minItems": 2,
            "prefixItems": [
              {
                "type": "string"
              },
              {
                "type": "string"
              }
            ]
          }
        },
        "delayed_ack": {
          "description": "(Publisher only) If true, do not wait for an acknowledgement when sending to broker. Defaults to false.",
          "type": "boolean",
          "default": false
        },
        "group_id": {
          "description": "Consumer group ID. Required for consumers.",
          "type": ["string", "null"]
        },
        "password": {
          "description": "Optional password for SASL authentication.",
          "type": ["string", "null"]
        },
        "producer_options": {
          "description": "Additional librdkafka producer configuration options (key-value pairs).",
          "type": ["array", "null"],
          "default": null,
          "items": {
            "type": "array",
            "maxItems": 2,
            "minItems": 2,
            "prefixItems": [
              {
                "type": "string"
              },
              {
                "type": "string"
              }
            ]
          }
        },
        "tls": {
          "description": "TLS configuration.",
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "accept_invalid_certs": false,
            "ca_file": null,
            "cert_file": null,
            "cert_password": null,
            "key_file": null,
            "required": false
          }
        },
        "topic": {
          "type": ["string", "null"]
        },
        "username": {
          "description": "Optional username for SASL authentication.",
          "type": ["string", "null"]
        }
      },
      "additionalProperties": false,
      "required": ["brokers"]
    },
    "MemoryConfig": {
      "type": "object",
      "properties": {
        "capacity": {
          "type": ["integer", "null"],
          "format": "uint",
          "minimum": 0
        },
        "topic": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": ["topic"]
    },
    "MetricsMiddleware": {
      "description": "Metrics middleware configuration. It's currently a struct without fields\nbut can be extended later. Its presence in the config enables the middleware.",
      "type": "object",
      "additionalProperties": false
    },
    "Middleware": {
      "description": "An enumeration of all supported middleware types.",
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "deduplication": {
              "$ref": "#/$defs/DeduplicationMiddleware"
            }
          },
          "additionalProperties": false,
          "required": ["deduplication"]
        },
        {
          "type": "object",
          "properties": {
            "metrics": {
              "$ref": "#/$defs/MetricsMiddleware"
            }
          },
          "additionalProperties": false,
          "required": ["metrics"]
        },
        {
          "type": "object",
          "properties": {
            "dlq": {
              "$ref": "#/$defs/DeadLetterQueueMiddleware"
            }
          },
          "additionalProperties": false,
          "required": ["dlq"]
        },
        {
          "type": "object",
          "properties": {
            "commit_concurrency": {
              "$ref": "#/$defs/CommitConcurrencyMiddleware"
            }
          },
          "additionalProperties": false,
          "required": ["commit_concurrency"]
        },
        {
          "type": "object",
          "properties": {
            "retry": {
              "$ref": "#/$defs/RetryMiddleware"
            }
          },
          "additionalProperties": false,
          "required": ["retry"]
        },
        {
          "type": "object",
          "properties": {
            "random_panic": {
              "$ref": "#/$defs/RandomPanicMiddleware"
            }
          },
          "additionalProperties": false,
          "required": ["random_panic"]
        },
        {
          "type": "object",
          "properties": {
            "delay": {
              "$ref": "#/$defs/DelayMiddleware"
            }
          },
          "additionalProperties": false,
          "required": ["delay"]
        }
      ]
    },
    "MongoDbEndpoint": {
      "description": "MongoDB endpoint configuration.",
      "type": "object",
      "properties": {
        "collection": {
          "type": ["string", "null"]
        },
        "database": {
          "description": "The database name.",
          "type": "string"
        },
        "password": {
          "description": "Optional password. Takes precedence over any credentials embedded in the `url`.\nUse embedded URL credentials for simple one-off connections but prefer explicit username/password fields (or environment-sourced secrets) for clarity and secret management in production.",
          "type": ["string", "null"]
        },
        "polling_interval_ms": {
          "description": "Polling interval in milliseconds for the consumer (when not using Change Streams). Defaults to 100ms.",
          "type": ["integer", "null"],
          "format": "uint64",
          "minimum": 0
        },
        "tls": {
          "description": "TLS configuration.",
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "accept_invalid_certs": false,
            "ca_file": null,
            "cert_file": null,
            "cert_password": null,
            "key_file": null,
            "required": false
          }
        },
        "ttl_seconds": {
          "description": "TTL in seconds for documents created by the publisher. If set, a TTL index is created.",
          "type": ["integer", "null"],
          "format": "uint64",
          "minimum": 0
        },
        "url": {
          "description": "MongoDB connection string URI. Can contain a comma-separated list of hosts for a replica set.\nCredentials provided via the separate `username` and `password` fields take precedence over any credentials embedded in the URL.",
          "type": "string"
        },
        "username": {
          "description": "Optional username. Takes precedence over any credentials embedded in the `url`.\nUse embedded URL credentials for simple one-off connections but prefer explicit username/password fields (or environment-sourced secrets) for clarity and secret management in production.",
          "type": ["string", "null"]
        }
      },
      "additionalProperties": false,
      "required": ["url", "database"]
    },
    "MqttEndpoint": {
      "description": "MQTT endpoint configuration.",
      "type": "object",
      "properties": {
        "clean_session": {
          "description": "If true, start with a clean session. Defaults to false (persistent session).",
          "type": "boolean",
          "default": false
        },
        "keep_alive_seconds": {
          "description": "Keep-alive interval in seconds. Defaults to 20.",
          "type": ["integer", "null"],
          "format": "uint64",
          "minimum": 0
        },
        "max_inflight": {
          "description": "Maximum number of inflight messages.",
          "type": ["integer", "null"],
          "format": "uint16",
          "maximum": 65535,
          "minimum": 0
        },
        "password": {
          "description": "Optional password for authentication.",
          "type": ["string", "null"]
        },
        "protocol": {
          "description": "MQTT protocol version (V3 or V5). Defaults to V5.",
          "$ref": "#/$defs/MqttProtocol",
          "default": "v5"
        },
        "qos": {
          "description": "Quality of Service level (0, 1, or 2). Defaults to 1.",
          "type": ["integer", "null"],
          "format": "uint8",
          "maximum": 255,
          "minimum": 0
        },
        "queue_capacity": {
          "description": "Capacity of the internal channel for incoming messages. Defaults to 100.",
          "type": ["integer", "null"],
          "format": "uint",
          "minimum": 0
        },
        "tls": {
          "description": "TLS configuration.",
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "accept_invalid_certs": false,
            "ca_file": null,
            "cert_file": null,
            "cert_password": null,
            "key_file": null,
            "required": false
          }
        },
        "topic": {
          "type": ["string", "null"]
        },
        "url": {
          "description": "MQTT broker URL (e.g., \"tcp://localhost:1883\"). Does not support multiple hosts.",
          "type": "string"
        },
        "username": {
          "description": "Optional username for authentication.",
          "type": ["string", "null"]
        }
      },
      "additionalProperties": false,
      "required": ["url"]
    },
    "MqttProtocol": {
      "type": "string",
      "enum": ["v5", "v3"]
    },
    "NatsEndpoint": {
      "description": "NATS endpoint configuration, combining connection and subject details.",
      "type": "object",
      "properties": {
        "default_stream": {
          "description": "The default stream name to use if not specified in the endpoint configuration.",
          "type": ["string", "null"]
        },
        "delayed_ack": {
          "description": "(Publisher only) If true, do not wait for an acknowledgement when sending to broker. Defaults to false.",
          "type": "boolean",
          "default": false
        },
        "no_jetstream": {
          "description": "If no_jetstream: true, use Core NATS (fire-and-forget) instead of JetStream. Defaults to false.",
          "type": "boolean",
          "default": false
        },
        "password": {
          "description": "Optional password for authentication.",
          "type": ["string", "null"]
        },
        "prefetch_count": {
          "description": "Number of messages to prefetch from the consumer. Defaults to 10000.",
          "type": ["integer", "null"],
          "format": "uint",
          "minimum": 0
        },
        "request_reply": {
          "description": "(Publisher only) If true, the publisher uses the request-reply pattern.\nIt sends a request and waits for a response (using `core_client.request_with_headers()`)\nwith timeout handling. Defaults to false.",
          "type": "boolean",
          "default": false
        },
        "request_timeout_ms": {
          "description": "Timeout for request-reply operations in milliseconds. Defaults to 2000ms.",
          "type": ["integer", "null"],
          "format": "uint64",
          "minimum": 0
        },
        "stream": {
          "type": ["string", "null"]
        },
        "stream_max_bytes": {
          "description": "Maximum total bytes in the stream (if created by the bridge). Defaults to 1GB.",
          "type": ["integer", "null"],
          "format": "int64"
        },
        "stream_max_messages": {
          "description": "Maximum number of messages in the stream (if created by the bridge). Defaults to 1,000,000.",
          "type": ["integer", "null"],
          "format": "int64"
        },
        "subject": {
          "type": ["string", "null"]
        },
        "tls": {
          "description": "TLS configuration.",
          "$ref": "#/$defs/TlsConfig",
          "default": {
            "accept_invalid_certs": false,
            "ca_file": null,
            "cert_file": null,
            "cert_password": null,
            "key_file": null,
            "required": false
          }
        },
        "token": {
          "description": "Optional token for authentication.",
          "type": ["string", "null"]
        },
        "url": {
          "description": "Comma-separated list of NATS server URLs (e.g., \"nats://localhost:4222,nats://localhost:4223\").",
          "type": "string"
        },
        "username": {
          "description": "Optional username for authentication.",
          "type": ["string", "null"]
        }
      },
      "additionalProperties": false,
      "required": ["url"]
    },
    "RandomPanicMiddleware": {
      "type": "object",
      "properties": {
        "probability": {
          "type": "number",
          "format": "double"
        }
      },
      "additionalProperties": false,
      "required": ["probability"]
    },
    "ResponseConfig": {
      "type": "object",
      "additionalProperties": false
    },
    "RetryMiddleware": {
      "type": "object",
      "properties": {
        "initial_interval_ms": {
          "type": "integer",
          "format": "uint64",
          "default": 100,
          "minimum": 0
        },
        "max_attempts": {
          "type": "integer",
          "format": "uint",
          "default": 3,
          "minimum": 0
        },
        "max_interval_ms": {
          "type": "integer",
          "format": "uint64",
          "default": 5000,
          "minimum": 0
        },
        "multiplier": {
          "type": "number",
          "format": "double",
          "default": 2.0
        }
      },
      "additionalProperties": false
    },
    "Route": {
      "description": "Defines a single message processing route from an input to an output.",
      "type": "object",
      "properties": {
        "batch_size": {
          "description": "(Optional) Number of messages to process in a single batch. Defaults to 1.",
          "type": "integer",
          "format": "uint",
          "default": 1,
          "minimum": 1
        },
        "concurrency": {
          "description": "(Optional) Number of concurrent processing tasks for this route. Defaults to 1.",
          "type": "integer",
          "format": "uint",
          "default": 1,
          "minimum": 1
        },
        "input": {
          "description": "The input/source endpoint for the route.",
          "$ref": "#/$defs/Endpoint"
        },
        "output": {
          "description": "The output/sink endpoint for the route.",
          "$ref": "#/$defs/Endpoint",
          "default": {
            "middlewares": [],
            "mode": "consume",
            "null": null
          }
        }
      },
      "additionalProperties": false,
      "required": ["input"]
    },
    "SwitchConfig": {
      "type": "object",
      "properties": {
        "cases": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/Endpoint"
          }
        },
        "default": {
          "anyOf": [
            {
              "$ref": "#/$defs/Endpoint"
            },
            {
              "type": "null"
            }
          ]
        },
        "metadata_key": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": ["metadata_key", "cases"]
    },
    "TlsConfig": {
      "description": "TLS configuration for secure connections.",
      "type": "object",
      "properties": {
        "accept_invalid_certs": {
          "description": "If true, disable server certificate verification (insecure).",
          "type": "boolean",
          "default": false
        },
        "ca_file": {
          "description": "Path to the CA certificate file.",
          "type": ["string", "null"]
        },
        "cert_file": {
          "description": "Path to the client certificate file (PEM).",
          "type": ["string", "null"]
        },
        "cert_password": {
          "description": "Password for the private key (if encrypted).",
          "type": ["string", "null"]
        },
        "key_file": {
          "description": "Path to the client private key file (PEM).",
          "type": ["string", "null"]
        },
        "required": {
          "description": "If true, enable TLS/SSL.",
          "type": "boolean"
        }
      },
      "additionalProperties": false,
      "required": ["required"]
    },
    "ZeroMqEndpoint": {
      "type": "object",
      "properties": {
        "bind": {
          "description": "If true, bind to the address. If false, connect.",
          "type": "boolean",
          "default": false
        },
        "internal_buffer_size": {
          "description": "Internal buffer size for the channel. Defaults to 128.",
          "type": ["integer", "null"],
          "format": "uint",
          "default": null,
          "minimum": 0
        },
        "socket_type": {
          "description": "The socket type (PUSH, PULL, PUB, SUB, REQ, REP).",
          "anyOf": [
            {
              "$ref": "#/$defs/ZeroMqSocketType"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        },
        "topic": {
          "type": ["string", "null"]
        },
        "url": {
          "description": "The ZeroMQ URL (e.g., \"tcp://127.0.0.1:5555\").",
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": ["url"]
    },
    "ZeroMqSocketType": {
      "type": "string",
      "enum": ["push", "pull", "pub", "sub", "req", "rep"]
    }
  }
}
